generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String     @id @default(cuid())
  clerkUserId                String     @unique
  email                      String     @unique
  name                       String?
  platformRole               Role       @default(DONOR)
  defaultClerkOrganisationId String?
  createdAt                  DateTime   @default(now())
  updatedAt                  DateTime   @updatedAt
  donations                  Donation[] @relation("DonorDonations")

  @@index([clerkUserId])
  @@index([email])
}

model Organisation {
  id                  String     @id @default(cuid())
  clerkOrganisationId String     @unique
  name                String
  slug                String     @unique
  approved            Boolean    @default(false)
  description         String?
  website             String?
  contactEmail        String?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  donations           Donation[]

  @@index([clerkOrganisationId])
  @@index([slug])
}

model Donation {
  id                   String         @id @default(cuid())
  organisationId       String
  donorUserId          String?
  title                String
  description          String?
  brand                String?
  colour               String?
  sizeLabel            String?
  category             Category
  condition            Condition
  season               Season?
  status               DonationStatus @default(SUBMITTED)
  aiCategorySuggestion String?
  aiConfidenceScore    Float?
  aiReviewed           Boolean        @default(false)
  shippingQrCodeUrl    String?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  imageUrl             String?
  donor                User?          @relation("DonorDonations", fields: [donorUserId], references: [id])
  organisation         Organisation   @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId, status])
  @@index([donorUserId])
}

enum Role {
  DONOR
  ORG_STAFF
  ORG_ADMIN
  PLATFORM_ADMIN
  DEVELOPER
}

enum DonationStatus {
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  SHIPPED
  RECEIVED
  ARCHIVED
}

enum Condition {
  NEW
  LIKE_NEW
  GOOD
  FAIR
  POOR
}

enum Category {
  TOPS
  BOTTOMS
  DRESSES
  OUTERWEAR
  SHOES
  ACCESSORIES
  OTHER
}

enum Season {
  ALL_SEASONS
  SPRING
  SUMMER
  AUTUMN
  WINTER
}
